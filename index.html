<!--
 * Bipardy - BIP39 Word Search Game
 * Copyright (C) 2025 BIPARDY
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <https://www.gnu.org/licenses/>.
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://api.github.com https://*.netlify.app;">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BIPardy">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0c29">
    <meta name="description" content="Master BIP-39 seed phrases in this fun word guessing game">
    
    <!-- PWA Links -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" href="icon-192.png">
    
    <title>BIPardy - BIP-39 Word Game</title>
    
    
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Matrix Rain Background -->
    <div class="matrix-container" id="matrixContainer"></div>
    
    <!-- Keyboard Toggle Button for Desktop -->
    <button class="keyboard-toggle" id="keyboardToggle">‚å®Ô∏è Keyboard</button>
    
    <!-- README Button for Desktop -->
    <a href="#" class="readme-button" id="readmeButton">üìñ README</a>
    
    <div class="app-container">
        <!-- Install Prompt -->
        <div class="install-prompt" id="installPrompt">
            <h3>Install BIPardy</h3>
            <p>Install this app on your home screen for the best experience!</p>
            <div class="install-buttons">
                <button class="install-btn primary" id="installBtn">Install</button>
                <button class="install-btn secondary" id="laterBtn">Later</button>
            </div>
        </div>

        <!-- Header Section -->
        <div class="header">
            <h1>BIPARDY</h1>
            <div class="player-selector" id="playerSelector">
                <button class="player-btn active" data-players="1">1 Player</button>
                <button class="player-btn" data-players="2">2 Players</button>
                <button class="player-btn" data-players="3">3 Players</button>
                <button class="player-btn" data-players="4">4 Players</button>
            </div>
            <div class="score-container" id="scoreContainer">
                <!-- Player scores will be dynamically added here -->
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area">
            <div class="controls">
                <div class="toggle-container">
                    <span class="toggle-label" id="gameLengthLabel">Game length: 12 words</span>
                    <div class="toggle-switch" id="gameLengthToggle"></div>
                </div>
                
                <div class="toggle-container">
                    <span class="toggle-label">Show word length</span>
                    <div class="toggle-switch" id="lengthToggle"></div>
                </div>
            </div>
            
            <!-- Timer Progress Bar -->
            <div class="timer-container" id="timerContainer">
                <div class="timer-bonus" id="timerBonus">+21 Bonus</div>
                <div class="timer-background">
                    <div class="timer-progress" id="timerProgress"></div>
                </div>
            </div>
            
            <div class="word-display">
                <div class="letter-container" id="letterContainer"></div>
                <div class="button-container">
                    <button class="game-button help-button" id="helpButton">HELP (-10)</button>
                    <button class="game-button skip-button" id="skipButton">SKIP</button>
                    <button class="game-button submit-button" id="submitButton">SUBMIT</button>
                </div>
            </div>
            
            <div class="message" id="message"></div>
        </div>

        <!-- Keyboard Section -->
        <div class="keyboard">
            <div class="keyboard-row">
                <div class="key" data-key="q">Q</div>
                <div class="key" data-key="w">W</div>
                <div class="key" data-key="e">E</div>
                <div class="key" data-key="r">R</div>
                <div class="key" data-key="t">T</div>
                <div class="key" data-key="y">Y</div>
                <div class="key" data-key="u">U</div>
                <div class="key" data-key="i">I</div>
                <div class="key" data-key="o">O</div>
                <div class="key" data-key="p">P</div>
            </div>
            <div class="keyboard-row">
                <div class="key" data-key="a">A</div>
                <div class="key" data-key="s">S</div>
                <div class="key" data-key="d">D</div>
                <div class="key" data-key="f">F</div>
                <div class="key" data-key="g">G</div>
                <div class="key" data-key="h">H</div>
                <div class="key" data-key="j">J</div>
                <div class="key" data-key="k">K</div>
                <div class="key" data-key="l">L</div>
            </div>
            <div class="keyboard-row">
                <div class="key special" data-key="backspace">‚Üê</div>
                <div class="key" data-key="z">Z</div>
                <div class="key" data-key="x">X</div>
                <div class="key" data-key="c">C</div>
                <div class="key" data-key="v">V</div>
                <div class="key" data-key="b">B</div>
                <div class="key" data-key="n">N</div>
                <div class="key" data-key="m">M</div>
                <div class="key special" data-key="enter">ENTER</div>
            </div>
        </div>
        
        <!-- Bottom attribution -->
        <div class="vibecoded-note">
            vibecoded with üß°
        </div>
    </div>

    <!-- Game End Screen -->
    <div class="game-end-screen" id="gameEndScreen">
        <div class="game-end-content">
            <h2 class="game-end-title" id="gameEndTitle">Game Complete!</h2>
            <div class="winner-name" id="winnerName"></div>
            <div class="final-stats" id="finalStats">
                <!-- Stats will be populated here -->
            </div>
            
            <button class="continue-button" id="continueButton">Continue</button>
            
            <!-- Leaderboard Section (only shown for single player) -->
            <div class="leaderboard-section" id="leaderboardSection" style="display: none;">
                <h3 class="leaderboard-title">üèÜ BIP39 Masters Leaderboard üèÜ</h3>
                
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" id="localTabBtn">üì± Local Best</button>
                    <button class="tab-btn" id="globalTabBtn">üåç Global Top</button>
                </div>

                <div class="leaderboard-submit" id="leaderboardSubmit">
                    <input type="text" 
                           class="name-input" 
                           id="playerNameInput" 
                           placeholder="Enter your name (A-Z, 0-9, 3-12 chars)"
                           maxlength="12">
                    <div class="eligibility-notice" id="eligibilityNotice" style="display: none;">
                        <!-- Dynamically populated based on score eligibility -->
                    </div>
                    <div class="submit-options">
                        <button class="submit-score-btn local" id="submitLocalBtn">
                            üíæ Save Locally Only
                        </button>
                        <button class="submit-score-btn global" id="submitGlobalBtn">
                            üåç Save Local + Share Global
                        </button>
                    </div>
                    <div class="privacy-note">
                        üí° Both options save to your device. Global also shares your score publicly for everyone to see.
                    </div>
                    
                    <!-- Social Sharing Section -->
                    <div class="social-share-section" id="socialShareSection" style="display: none;">
                        <h4>üéâ Share Your Achievement!</h4>
                        <div class="share-buttons">
                            <button onclick="shareOnX()" class="share-btn x-share">
                                ùïè Share on X
                            </button>
                            <button onclick="shareOnNostrWeb()" class="share-btn nostr-web">
                                ‚ö° Share on Nostr (Web)
                            </button>
                            <button onclick="copyNostrWithScreenshot()" class="share-btn nostr-native">
                                ‚ö°üìã Copy for Nostr + Screenshot
                            </button>
                            <button onclick="downloadScreenshot()" class="share-btn download">
                                üì∏ Download Screenshot
                            </button>
                        </div>
                    </div>
                    <div class="multiplayer-submission-info" id="multiplayerSubmissionInfo" style="display: none;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-top: 10px; text-align: center;">
                            üéÆ Multiplayer Mode: Each qualifying player can submit their score individually
                        </div>
                    </div>
                </div>
                
                <div class="rank-status" id="rankStatus"></div>
                
                <div class="leaderboard-list" id="leaderboardList">
                    <div style="text-align: center; color: rgba(255, 255, 255, 0.6); padding: 20px;">
                        Loading leaderboard...
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <!-- External Scripts -->
    <!-- html2canvas is now lazy-loaded only when needed -->
    
    <script type="module">
        // Import modules
        import { initializePWA } from './js/utils/pwa-manager.js';
        import { shuffleArray, initializeEntropyCollection } from './js/utils/entropy-manager.js';
        
        // Initialize modules
        initializePWA();
        initializeEntropyCollection();
        
        // Make shuffleArray globally available for game.js
        window.shuffleArray = shuffleArray;
        
        // Wait for DOM to be ready, then initialize game
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (window.initializeGame) {
                    window.initializeGame();
                } else {
                    console.error('initializeGame function not found!');
                }
            });
        } else {
            // DOM already loaded
            setTimeout(() => {
                if (window.initializeGame) {
                    window.initializeGame();
                } else {
                    console.error('initializeGame function not found!');
                }
            }, 100); // Small delay to ensure game.js is loaded
        }
    </script>
    <script src="game.js"></script>
</body>
</html>
